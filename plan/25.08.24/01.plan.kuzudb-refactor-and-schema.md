### 계획: KuzuDB 모듈화 및 노트 스키마 적용

**목표**: 기존의 KuzuDB 테스트 코드를 모듈화된 구조로 리팩토링하고, 기획서에 명시된 `Note` 관련 스키마를 적용하여 실제 애플리케이션에서 사용할 수 있는 데이터베이스 백엔드 기반을 마련합니다.

- [x] **1. KuzuDB 관련 코드 모듈화**
    - [x] `src-tauri/src/kuzudb/` 디렉토리를 생성하여 데이터베이스 관련 코드를 통합 관리합니다.
    - [x] 기존 `src-tauri/src/kuzu_query.rs`의 내용을 `src-tauri/src/kuzudb/` 하위의 적절한 모듈(예: `connection.rs`, `schema.rs`)로 리팩토링하여 이전하고, 기존 파일은 삭제합니다.

- [x] **2. 데이터베이스 인스턴스 관리 개선**
    - [x] `kuzudb/connection.rs`에서 KuzuDB `Database`와 `Connection`을 관리하는 로직을 구현합니다.
    - [x] 데이터베이스 파일 경로는 현재 활성화된 볼트 경로(예: `{vault_path}/.luman/db`)를 기반으로 동적으로 생성되도록 구현합니다.
    - [x] 생성된 DB 커넥션을 Tauri의 `State`로 등록하여, 앱 전역에서 싱글톤으로 안전하게 접근할 수 있도록 `main.rs`를 수정합니다.

- [x] **3. `Note` 스키마 적용**
    - [x] `kuzudb/schema.rs`에 `initialize_schema` 함수를 구현합니다.
    - [x] 이 함수는 기획서에 명시된 `Note` 노드 테이블과 `ChildOf`, `Next` 관계 테이블이 없는 경우에만 생성하는 쿼리를 실행합니다.
    - [x] 앱이 시작되거나 볼트가 로드될 때, 이 함수를 호출하여 DB 스키마를 초기화하도록 설정합니다.

- [x] **4. `Note` 데이터 모델 정의**
    - [x] `src-tauri/src/models/note.rs` 파일을 생성하고, 기획서에 따라 `Note` Rust `struct`를 정의합니다.

- [x] **5. 온톨로지 문서 업데이트**
    - [x] 새로 생성되거나 리팩토링된 `kuzudb` 모듈의 각 파일과 `models/note.rs` 파일에 대한 온톨로지 문서를 작성하거나 업데이트합니다.

***

## 📁 디렉터리 구조 제안

```
src-tauri/
  └── src/
        ├── kuzudb/
        │      ├── connection.rs      // 인스턴스/커넥션 싱글톤 관리
        │      ├── schema.rs          // initialize_schema 등 쿼리 정의
        │      ├── mod.rs             // (kuzudb 공개 모듈, pub use 등)
        │      └── (추후 query.rs 등) // 도메인별 쿼리전용
        └── models/
               └── note.rs            // Note 구조체 및 변환
        └── main.rs                   // tauri state 등록, vault-path 연동
```

***

## 🟦 작업 플로우/첫 단계 Action

1. `src-tauri/src/kuzudb/` 디렉터리부터 생성  
2. `connection.rs` → DB파일 경로/커넥션 구조체,
   - 볼트(폴더) 경로 기반 `{vault}/.luman/db` 동적 관리
   - 싱글톤/tauri State로 제공
3. `schema.rs` → 기획서 Note스키마/관계/초기화 쿼리/함수
4. `models/note.rs` → Note 구조체/타입, DB→Struct 변환, serde 등
5. 기타: 각 모듈/파일 상단에 설계의도, 용도, 필드설명 ‘온톨로지’ 주석

***

## ⛳ 추천:  
- 변경내역/진행상황/모듈별 설명은  
  **kuzudb/README.md** 또는 각 파일 상단 doc comment(`///`)로 문서화
- 최초는 "1 테이블 2관계 + 연결성 테스트"로,  
  이후 쿼리/관계/검색 등 모듈로 점진 분리

***

## 👍 결론  
- **`kuzudb` 폴더 네이밍은 일관성, 명확성, 실전성에서 매우 우수**  
- 즉시 작업 시작 강력 추천!  
- **이후 단계별 PR/댓글에서, 각 모듈(파일) 설계/코드 예시/쿼리도 즉시 안내/점검 가능합니다.**


```Rust
// 예시: Note/ChildOf/Next로 구조만 바꾼 초기화
conn.query("CREATE NODE TABLE Note(
                uuid STRING PRIMARY KEY,
                title STRING, 
                content STRING, 
                created_at DATETIME, 
                updated_at DATETIME, 
                rank STRING, 
                parent_uuid STRING, 
                file_path STRING
            )").map_err(|e| e.to_string())?;

conn.query("CREATE REL TABLE ChildOf(FROM Note TO Note)").map_err(|e| e.to_string())?;
conn.query("CREATE REL TABLE Next(FROM Note TO Note)").map_err(|e| e.to_string())?;
```
