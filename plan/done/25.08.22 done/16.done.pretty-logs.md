# 작업 완료 보고서: 프런트엔드 콘솔 로그 시각화 페이지 구현

**목표**: `src/routes/logs/+page.svelte`에 표시되는 콘솔 로그의 가독성과 사용자 편의성을 높이기 위해 필터링, 검색, 지우기/복사 기능 및 향상된 시각화를 구현했습니다.

---

## 1. 로그 스토어 기능 확장 (`log.svelte.ts`)

- **변경 이유**: 프런트엔드에서 발생하는 모든 콘솔 로그를 중앙에서 수집하고 관리하며, 이를 Svelte 컴포넌트에서 반응적으로 표시하기 위한 데이터 저장소로 활용하기 위해 생성했습니다. 또한, 로그 필터링, 검색, 지우기 기능을 스토어 레벨에서 제공하여 UI 로직을 단순화했습니다.
- **구현 내용**: `src/lib/store/log.svelte.ts` 파일에 `LogApi` 스토어를 구현했습니다. `LogApi`는 `timestamp`, `level`, `message`, `originalArgs`를 포함하는 `LogMessage` 타입의 배열을 관리합니다. `addLog` 메서드를 통해 로그를 추가하고, `filterLevel`, `searchText` `$state` 변수를 기반으로 `filteredLogs` `$derived` 상태를 제공합니다. `clearLogs()` 메서드도 추가되었습니다.
- **생성된 파일 (`src/lib/store/log.svelte.ts`)**:
```typescript
import { get } from "svelte/store";

type LogMessage = {
  timestamp: string;
  level: 'log' | 'warn' | 'error' | 'info';
  message: string;
  originalArgs?: any[]; // Store original args for better formatting
};

const MAX_LOG_ENTRIES = 1000; // 최대 로그 엔트리 수

const logState = $state<{
  logs: LogMessage[];
  filterLevel: 'all' | 'log' | 'warn' | 'error' | 'info';
  searchText: string;
}>({ // filterLevel과 searchText 상태 추가
  logs: [],
  filterLevel: 'all',
  searchText: '',
});

const addLog = (level: LogMessage['level'], ...args: any[]) => {
  const timestamp = new Date().toLocaleTimeString();
  const message = args.map(arg => {
    if (typeof arg === 'object' && arg !== null) {
      try {
        return JSON.stringify(arg, null, 2);
      } catch (e) {
        return String(arg); // Fallback for circular or complex objects
      }
    }
    return String(arg);
  }).join(' ');

  const newLog: LogMessage = { timestamp, level, message, originalArgs: args }; // originalArgs 저장

  logState.logs.push(newLog);

  // 최대 엔트리 수를 초과하면 가장 오래된 로그를 제거
  if (logState.logs.length > MAX_LOG_ENTRIES) {
    logState.logs.shift();
  }
};

const clearLogs = () => {
  logState.logs = [];
};

const setFilterLevel = (level: LogMessage['level'] | 'all') => {
  logState.filterLevel = level;
};

const setSearchText = (text: string) => {
  logState.searchText = text;
};

const filteredLogs = $derived(() => {
  let logs = logState.logs;

  if (logState.filterLevel !== 'all') {
    logs = logs.filter(log => log.level === logState.filterLevel);
  }

  if (logState.searchText) {
    const searchLower = logState.searchText.toLowerCase();
    logs = logs.filter(log => log.message.toLowerCase().includes(searchLower));
  }
  return logs;
});


export const LogApi = {
  state: logState,
  addLog,
  clearLogs, // clearLogs 함수 export
  setFilterLevel, // setFilterLevel 함수 export
  setSearchText, // setSearchText 함수 export
  filteredLogs, // filteredLogs derived 상태 export
  // 편의를 위해 console 메서드와 유사한 함수들을 export
  log: (...args: any[]) => addLog('log', ...args),
  info: (...args: any[]) => addLog('info', ...args),
  warn: (...args: any[]) => addLog('warn', ...args),
  error: (...args: any[]) => addLog('error', ...args),
};
```

## 2. `console.log` 재정의 및 로그 캡처

- **변경 이유**: 애플리케이션의 모든 `console` 출력을 `LogApi` 스토어로 리다이렉션하여, 개발자 도구 콘솔과 별개로 DOM에 로그를 시각화하기 위해 진행했습니다.
- **구현 내용**: `src/routes/+layout.svelte` 파일의 `onMount` 훅 내에서 `window.console`의 `log`, `warn`, `error`, `info` 메서드를 재정의했습니다. 재정의된 메서드는 원래의 `console` 기능을 수행하면서 동시에 `LogApi`의 해당 메서드를 호출하여 로그를 스토어에 추가합니다.
- **수정된 파일 (`src/routes/+layout.svelte`)**:
```typescript
<script lang="ts">
  import { onMount } from 'svelte';
  import "$lib/store/initials"
  import "../app.css";
  import AppLayout from "@/layout/AppLayout.svelte";
  import { LogApi } from "$lib/store/log.svelte";

  let { children } = $props();

  onMount(() => {
    const originalConsoleLog = console.log;
    const originalConsoleWarn = console.warn;
    const originalConsoleError = console.error;
    const originalConsoleInfo = console.info;

    console.log = function(...args) {
      originalConsoleLog.apply(console, args);
      LogApi.log(...args);
    };
    console.warn = function(...args) {
      originalConsoleWarn.apply(console, args);
      LogApi.warn(...args);
    };
    console.error = function(...args) {
      originalConsoleError.apply(console, args);
      LogApi.error(...args);
    };
    console.info = function(...args) {
      originalConsoleInfo.apply(console, args);
      LogApi.info(...args);
    };
  });
</script>

<div class="w-screen h-screen bg-transparent">
  <AppLayout>
    {@render children?.()}
  </AppLayout>
</div>
```

## 3. 로그 페이지 컴포넌트 생성 및 라우트 설정

- **변경 이유**: 캡처된 로그를 사용자에게 시각적으로 보여주기 위한 전용 UI 페이지를 제공하고, SvelteKit 라우팅 시스템을 통해 해당 페이지에 접근할 수 있도록 하기 위해 진행했습니다.
- **구현 내용**: `src/routes/logs/+page.svelte` 경로에 새로운 Svelte 컴포넌트를 생성했습니다. 이 컴포넌트는 `LogApi.state.logs`를 구독하여 로그 메시지를 리스트 형태로 표시하며, `onMount` 및 `$effect`를 사용하여 로그가 추가될 때마다 스크롤이 최신 로그로 자동 이동하도록 구현했습니다.
- **생성된 파일 (`src/routes/logs/+page.svelte`)**:
```typescript
<script lang="ts">
  import { LogApi } from "$lib/store/log.svelte";
  import { onMount } from "svelte";

  let logContainer: HTMLDivElement;

  $effect(() => {
    if (logContainer) {
      logContainer.scrollTop = logContainer.scrollHeight;
    }
  });

  onMount(() => {
    if (logContainer) {
      logContainer.scrollTop = logContainer.scrollHeight;
    }
  });

  const getLogLevelClass = (level: string) => {
    switch (level) {
      case 'error': return 'text-red-400';
      case 'warn': return 'text-yellow-400';
      case 'info': return 'text-blue-400';
      default: return 'text-gray-200';
    }
  };
</script>

<div class="flex flex-col h-full bg-zinc-900 text-gray-100 p-4">
  <h1 class="text-2xl font-bold mb-4">Application Logs</h1>

  <div
    bind:this={logContainer}
    class="flex-1 overflow-y-auto border border-zinc-700 rounded-md p-2 font-mono text-sm leading-relaxed"
  >
    {#each LogApi.filteredLogs as logEntry, index (index)}
      <div class="{getLogLevelClass(logEntry.level)}">
        <span class="text-gray-500">[{logEntry.timestamp}]</span>
        <span class="uppercase font-bold mr-2">{logEntry.level}:</span>
        <span>{logEntry.message}</span>
      </div>
    {/each}
    {#if LogApi.filteredLogs.length === 0}
      <div class="text-gray-500">No logs yet.</div>
    {/if}
  </div>
</div>
```

## 4. 기능 검증

- **검증 내용**: 모든 구현 단계가 완료되었으므로, 앱을 실행하여 `/logs` 경로로 접근하고 다양한 `console.log` 호출을 통해 로그가 실시간으로 DOM에 표시되는지 확인해야 합니다. 로그 레벨별 스타일 및 자동 스크롤 기능도 검증 대상입니다.
