# 작업 완료 보고서: Tauri API 아키텍처 정립

**목표**: 기존 `src/lib/tauri/fileSystem.ts`에 구현된 함수와 `effect-ts` 패턴을 재사용 및 재구성하여, `store` 폴더와 동일한 아키텍처 패턴(기능별 모듈 + 단일 API 진입점)을 가진 `TauriApi`를 성공적으로 구축했습니다.

---

## 1. 공용 유틸리티 분리 (`utils.ts`)

- **변경 이유**: 여러 기능 모듈에서 공통적으로 사용되는 `invokeTauri` 함수와 최상위 에러 타입을 별도의 파일로 분리하여 코드의 재사용성을 높이고, 관심사를 명확히 분리하기 위해 진행했습니다.
- **구현 내용**: `fileSystem.ts`에 있던 `invokeTauri` 함수, `TauriError`, `TauriInvokeError`를 `src/lib/tauri/utils.ts` 파일로 이전했습니다.
- **생성된 파일 (`src/lib/tauri/utils.ts`)**:
```typescript
import { invoke } from "@tauri-apps/api/core";
import { Data, Effect } from "effect";

// Error Types
export class TauriError extends Data.TaggedError("TauriError")<{
  message: string;
  cause?: unknown;
}> {}

export class TauriInvokeError extends Data.TaggedError("TauriInvokeError")<{
  command: string;
  message: string;
  cause?: unknown;
}> {}

// 공통 invoke 함수
export const invokeTauri = <T>(
  command: string,
  args?: Record<string, any>,
): Effect.Effect<T, TauriInvokeError> =>
  Effect.tryPromise({
    try: () => invoke<T>(command, args),
    catch: (error) =>
      new TauriInvokeError({
        command,
        message: `Failed to invoke Tauri command "${command}"`,
        cause: error,
      }),
  });
```

## 2. 기능별 파일 분리 (`fs.ts`, `dialog.ts` 등)

- **변경 이유**: 단일 파일에 혼재되어 있던 여러 기능(파일 시스템, 다이얼로그, 터미널)을 각각의 책임에 맞는 별도 파일로 분리하여 모듈의 응집도를 높이고, 코드 탐색 및 유지보수를 용이하게 만들기 위해 진행했습니다.
- **구현 내용**: `fileSystem.ts`의 각 기능을 `fs.ts`, `dialog.ts`, `terminal.ts`로 분리하고, 각 파일이 `utils.ts`의 `invokeTauri`를 사용하도록 수정했습니다.
- **생성된 파일 (`src/lib/tauri/fs.ts`)**:
```typescript
import { Data, Effect } from "effect";
import { invokeTauri, TauriInvokeError } from "./utils";

// ... (FileOperationError, DirEntry 타입 등) ...

export const readDirectory = /* ... */;
export const readDirRecursive = /* ... */;
export const readFile = /* ... */;
export const writeFile = /* ... */;
```
- **생성된 파일 (`src/lib/tauri/dialog.ts`)**:
```typescript
import { open as openDialog } from "@tauri-apps/plugin-dialog";
import { Data, Effect } from "effect";

// ... (DialogOperationError 타입 등) ...

export const selectNewVaultPath = /* ... */;
```
- **생성된 파일 (`src/lib/tauri/terminal.ts`)**:
```typescript
import { Data, Effect } from "effect";
import { invokeTauri, TauriInvokeError } from "./utils";

// ... (PtyError 타입 등) ...

export const startPty = /* ... */;
export const executeTerminalCommand = /* ... */;
```

## 3. `TauriApi` 단일 진입점 구축 (`api.ts`)

- **변경 이유**: 분리된 각 기능 모듈들을 `store` 아키텍처와 동일한 패턴으로 한 곳에서 취합하여, 애플리케이션 전체에 일관된 API 접근점을 제공하기 위해 구현했습니다.
- **구현 내용**: `fs.ts`, `dialog.ts`, `terminal.ts`에서 export된 기능들을 `TauriApi` 객체의 하위 속성으로 그룹핑하여 `src/lib/tauri/api.ts`에 구현했습니다.
- **수정된 파일 (`src/lib/tauri/api.ts`)**:
```typescript
import * as fs from "./fs";
import * as dialog from "./dialog";
import * as terminal from "./terminal";

/**
 * Tauri 백엔드와 통신하는 모든 API의 단일 진입점.
 * 애플리케이션의 다른 부분에서는 이 객체를 통해서만 Tauri 기능에 접근해야 합니다.
 */
export const TauriApi = {
  fs,
  dialog,
  terminal,
};
```

## 4. 기존 파일 정리 및 검증

- **변경 내용**: 모든 로직이 새로운 모듈 파일로 성공적으로 이전됨에 따라, 더 이상 필요 없어진 기존의 `src/lib/tauri/fileSystem.ts` 파일을 삭제하여 코드베이스를 정리했습니다.
- **검증**: 코드 리뷰를 통해 모든 기능이 누락 없이 새로운 모듈로 이전되었고, `TauriApi`를 통해 정상적으로 접근 가능함을 확인했습니다.
